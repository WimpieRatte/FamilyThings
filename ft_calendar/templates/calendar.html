{% extends "site/site_base.html" %}
{% load static %}
{% block title %}Calendar -{% endblock %}
{% block popups %}{% endblock %}
{% block content %}
<div id="calendar" class="container-sm pb-4" style="width: 90%;">
    {% include 'site/heading_section.html' with label="Calendar" id="calendar" %}
    <div id="calendar-section" class="h-25 mh-25 d-flex justify-content-between py-4">
        <div>
            <div id="calendar-wrapper" class="w-fit rounded bg-dark rounded p-2 overflow-visible position-relative" style="height: fit-content; scale: 115%; transform-origin: left top;">
                <form action="#" class="row">
                    <div id="rome-calendar"></div>
                </form>
                <div id="new-accomplishment-wrapper" class="w-auto mt-3 position-absolute top-100 start-50 translate-middle-x">
                    <a id="add-new-button" class="nav-link m-auto tooltip-source" style="width: fit-content;" data-tooltip-context="Add New">
                        <h4 id="new-accomplishment-label" class="text-center m-0 p-1 bg-dark rounded p-1">
                        <i id="new-accomplishment-icon" class="bi bi-plus-square-fill text-center fs-1"></i></h4>
                    </a>
                </div>
            </div>
        </div>
        <div class="rounded-2 p-4 bg-dark overflow-auto" style="height: 450px !important; max-height: 450px !important; width: 65%;">
            <div id="calendar-date" class="bg-primary rounded-2 p-1 m-0" style="width: 35% !important;">-</div>
            <div id="accordion" class="accordion accordion fs-sm pt-2">
            </div>
        </div>
    </div>
</div>
<style>
    .card-header.birthday {
        background-color: var(--bs-success) !important;
    }

    .card-header.birthday span::before {
        content: "\f8e9";
    }

    .btn[aria-expanded=true] .bi-caret-down-fill:not(.birthday) {
        opacity: 0.3 !important;
    }

    .btn[aria-expanded=true] .bi-caret-down-fill::before:not(.birthday) {
        content: "\F238" !important;
    }
</style>
<link href="{% static 'rome/rome.css'%}" rel="stylesheet">
<script src="{% static 'rome/rome.js'%}"></script>
<script>
    {% include 'js_calendar_rome.js' %}
    $(".rd-next").click(function(event) { setTimeout(function() {resetDayButtons();}, 1)});
    $(".rd-back").click(function(event) { setTimeout(function() {resetDayButtons();}, 1)});

    setTimeout(function() {updateDate()}, 1000)

    function updateDate(event){
        let dateToCheck = calendar.getDate();
        let entries = null;

        $("#calendar-date").text(dateToCheck.toLocaleDateString('default', { weekday: "long", year: "numeric", month: "long", day: "numeric", }));

        entries = calendarEntries.filter((element) => 
        element["date"].getDate() == dateToCheck.getDate()
        && element["date"].getMonth() == dateToCheck.getMonth()
        && element["date"].getYear() == dateToCheck.getYear());

        // Put entries on screen
        $("#accordion").text(''); // Clear so that there's space for the list

        if (entries.length > 0) {
            $("#accordion").text(''); // Clear so that there's space for the list
            entries.forEach(function(entry) {
                $("#accordion").append(`<div id="card${entry["ID"]}" class="card"></div>`);

                let extraClasses = "";
                if (entry["description"] && entry["description"].length > 0){ extraClasses = " bi-caret-down-fill bi-space" }
                    else { extraClasses = " bi-circle-fill bi-space bi-small" }

                setTimeout(function() {
                    $(`#card${entry["ID"]}`).append(`
                        <div class="card-header card-footer ${entry["type"]}" id="heading${entry["ID"]}">
                        <h5 class="mb-0">
                            <button class="btn btn-link link-underline link-underline-opacity-0 text-body-emphasis py-2" data-bs-toggle="collapse" data-bs-target="#calendarEntry${entry["ID"]}" aria-controls="collapseOne">
                            <span class="bi ${extraClasses}">${entry["title"]}</span>
                            </button>
                        </h5>
                        </div>`
                    );

                    if (entry["description"] && entry["description"].length > 0) {
                        $(`#card${entry["ID"]}`).append(`
                            <div id="calendarEntry${entry["ID"]}" class="collapse" aria-labelledby="heading${entry["ID"]}" data-bs-parent="#accordion">
                            <div class="card-body">
                                ${entry["description"]}
                            </div>
                            </div>`
                        );
                    }
                }, 1);
            });
            $("#accordion").append('</div>')
        }
        else {
            $("#accordion").append(`
            <div id="card" class="card">
                <div class="card-header card-footer" id="">
                <h5 class="mb-0">
                    <button class="btn btn-link link-underline link-underline-opacity-0 text-body-emphasis py-2">
                        <span class="bi bi bi-circle-fill bi-space bi-small">No entries.</span>
                    </button>
                </h5>
            </div>`);
        }
    }
</script>
{% endblock %}