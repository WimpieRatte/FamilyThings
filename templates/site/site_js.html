{% load static %}
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script>
    /* Custon Cursor & Little Background Movement based on the Cursor's position */
    const root = document.querySelector(":root");
    const cursor = document.querySelector('#cursor-base');
    const cursorImage = document.querySelector('#cursor-image');
    const cursorShadow = document.querySelector('#cursor-shadow');
    const tooltip = document.querySelector('#tooltip');

    const imgCursorRegular = 'cursor-regular';
    const imgCursorText = 'cursor-text';


    const updateCursorPosition = (e)=> {
        root.style.backgroundPositionX = e.clientX*-.01 + "px";
        root.style.backgroundPositionY = e.clientY*-.01 + "px";
        cursor.style.transform = `translate3d(${e.clientX}px, ${e.clientY}px, 0)`;
        tooltip.style.transform = `translate3d(calc(${e.clientX}px + 30px), calc(${e.clientY}px + 30px), 0)`;

        cursor.style.display = "block";
        cursorShadow.style.display = "block";
        cursorImage.src = "{{HOST}}/static/icons/cursor/" + imgCursorRegular + ".svg";
        cursorShadow.src = "{{HOST}}/static/icons/cursor/" + imgCursorRegular + "-shadow.svg";
    }
    window.addEventListener('mousemove', updateCursorPosition);

    $("a").on( "mouseover", function() {
        console.log("bruh")
        cursorImage.src = "{{HOST}}/static/icons/cursor/" + imgCursorText + ".svg";
    });

    /* Tooltip */
    $(".tooltip-source").on( "mouseover", function() {
        let text = $(this).attr('data-tooltip-content')

        if (text != "" && cursor.style.display != "none"){
            tooltip.style.display = "block";
            tooltip.textContent = $(this).attr('data-tooltip-content');
        }
    });

    addEventListener("mouseout", (event) => {
        tooltip.style.display = "none";
    })

    /* Date&Time display */
    update_time()
    setInterval(update_time, 1000);
    async function update_time(){
        time = new Date();
        document.getElementById("datetime-display")
        .textContent = time.toLocaleString('default', { weekday: "long", year: "numeric", month: "long", day: "numeric", })
        + ' ' + time.toLocaleTimeString();
    }

    /* Localization */
    $.getJSON("{% static '/localization/lang_de.json' %}", function(json) {
        console.log(Object.entries(json))
        let json_entries = Object.entries(json)

        for (let i = 0; i < json_entries.length; i++) {
            let element = document.querySelector("#" + json_entries[i][0]);
            if (element) {
                switch (element.localName) {
                    case "textarea":
                        element.placeholder = json_entries[i][1];
                        break;
                    default:
                        element.textContent = json_entries[i][1];
                        break;
                }
            }
        }
    });


    /* update_low_priority();
    setInterval(update_low_priority, 20000);
    async function update_low_priority(){
        fetch('/test', { method: "GET",
        headers: { "X-Requested-With": "XMLHttpRequest"}})
        .then(response => response.json().then(json_data => ({
            time: json_data['time']
        }))
        .then(result => {
            /*document.getElementById("datetime-display").textContent = result.time;
        })); 
    }*/
</script>